# MindMap 思维导图软件需求文档 v1

## 一、项目概述

### 1.1 目标
开发一款跨平台思维导图软件，类似 XMind / MindNode / FreeMind。

### 1.2 技术栈
- **语言**: Rust
- **UI 框架**: Qt6 (rust-qt-binding 或 cxx-qt)
- **图形**: QGraphicsView / QGraphicsScene
- **文件格式**: JSON (自有格式) + 兼容 XMind/FreeMind

---

## 二、核心功能需求

### 2.1 节点系统
| 功能 | 描述 | 优先级 |
|-----|------|-------|
| 创建节点 | 根节点、子节点、兄弟节点 | P0 |
| 节点编辑 | 纯文本编辑 | P0 |
| 节点删除 | 删除节点及其所有子节点 | P0 |
| 节点样式 | 形状（矩形/圆角/圆形）、颜色、边框 | P1 |
| 图标/标签 | 优先级图标、进度图标、自定义标签 | P1 |
| 附件 | 支持添加图片、超链接 | P2 |

### 2.2 连接线与布局
| 功能 | 描述 | 优先级 |
|-----|------|-------|
| 贝塞尔曲线 | 平滑的父子连接线 | P0 |
| 自动布局 | 向右展开 / 左右对称 / 向下展开 / 自由布局 | P0 |
| 手动调整 | 拖动节点位置 | 不支持 |
| 连线样式 | 颜色、粗细、虚线/实线、箭头 | P1 |

### 2.3 画布操作
| 功能 | 描述 | 优先级 |
|-----|------|-------|
| 平移拖拽 | 空格+拖拽 或 中键拖拽 | P0 |
| 缩放 | Ctrl+滚轮、捏合手势、按钮 | P0 |
| 框选 | 拖拽框选多个节点 | P1 |
| 缩略图 | 右下角缩略图导航 | P2 |

### 2.4 文件与导入导出
| 功能 | 描述 | 优先级 |
|-----|------|-------|
| 保存/打开 | .mindmap (JSON 格式) | P0 |
| 导出图片 | PNG、SVG、PDF | P1 |
| 导入 XMind | 兼容 .xmind 文件 | P2 |
| 导入 FreeMind | 兼容 .mm 文件 | P2 |
| 导出 Markdown | .md 大纲格式 | P2 |

### 2.5 多窗口与多标签
| 功能 | 描述 | 优先级 |
|-----|------|-------|
| 多标签页 | 一个窗口多个思维导图 | P1 |
| 多窗口 | 新建独立窗口 | P2 |
| 分屏 | 左右对比两个导图 | P3 |

---

## 三、界面布局设计

```
┌─────────────────────────────────────────────────────────┐
│  菜单栏 (File Edit View Format Help)                    │
├─────────────────────────────────────────────────────────┤
│  工具栏 [新建] [打开] [保存] [撤销] [重做] [+节点] ...    │
├─────────────────────────────────────────────────────────┤
│  ┌─────────────┬──────────────────────────┬──────────┐ │
│  │             │                          │          │ │
│  │   侧边栏    │        画布区域           │  属性栏   │ │
│  │  (大纲/主题) │    (QGraphicsView)       │ (样式/格式)│ │
│  │             │                          │          │ │
│  │             │      [思维导图内容]        │          │ │
│  │             │                          │          │ │
│  │             │                          │          │ │
│  └─────────────┴──────────────────────────┴──────────┘ │
├─────────────────────────────────────────────────────────┤
│  状态栏  缩放: 100% | 节点数: 15 | 位置: (120, 340)     │
└─────────────────────────────────────────────────────────┘
```

---

## 四、交互规范

### 4.1 鼠标操作
| 操作 | 功能 |
|-----|------|
| 单击节点 | 选中节点 |
| 双击节点 | 进入编辑模式 |
| 右键节点 | 弹出上下文菜单 |
| 拖拽节点 | 移动节点位置（自由布局模式）|
| 空白处拖拽 | 平移画布 |
| 滚轮 | 上下滚动 |
| Ctrl+滚轮 | 缩放画布 |
| Shift+单击 | 多选 |
| 空白处框选 | 框选多个节点 |

### 4.2 键盘快捷键
| 快捷键 | 功能 |
|-------|------|
| Tab | 添加子节点 |
| Enter | 添加兄弟节点 / 完成编辑 |
| Delete | 删除选中节点 |
| Ctrl+Z | 撤销 |
| Ctrl+Shift+Z / Ctrl+Y | 重做 |
| Ctrl+S | 保存 |
| Ctrl+N | 新建 |
| Ctrl+O | 打开 |
| Ctrl++ / Ctrl+- | 放大/缩小 |
| Ctrl+0 | 重置缩放 |
| Esc | 取消编辑 / 取消选择 |
| F2 | 编辑选中节点 |
| 方向键 | 在节点间导航 |

---

## 五、数据结构

### 5.1 节点结构 (JSON)
```json
{
  "id": "uuid",
  "text": "节点文本",
  "x": 100.0,
  "y": 200.0,
  "style": {
    "shape": "rounded_rect",
    "fill_color": "#FFFFFF",
    "border_color": "#333333",
    "border_width": 2,
    "font_family": "PingFang SC",
    "font_size": 14,
    "text_color": "#000000"
  },
  "collapsed": false,
  "children": [...]
}
```

### 5.2 文件结构
```json
{
  "version": "1.0",
  "metadata": {
    "title": "未命名",
    "created_at": "2024-01-15T10:30:00Z",
    "modified_at": "2024-01-15T11:00:00Z"
  },
  "canvas": {
    "width": 2000,
    "height": 2000,
    "background_color": "#F5F5F5",
    "show_grid": true
  },
  "root": { ...节点结构... }
}
```

---

## 六、模块划分 (Rust)

```
src/
├── main.rs              # 入口
├── app.rs               # QApplication 封装
├── window.rs            # 主窗口
├── canvas/
│   ├── mod.rs           # 画布模块
│   ├── view.rs          # QGraphicsView 子类
│   ├── scene.rs         # QGraphicsScene 管理
│   └── minimap.rs       # 缩略图
├── node/
│   ├── mod.rs           # 节点模块
│   ├── item.rs          # QGraphicsItem 节点
│   ├── edit.rs          # 文本编辑
│   └── style.rs         # 节点样式
├── layout/
│   ├── mod.rs           # 布局模块
│   ├── mindmap.rs       # 思维导图布局（右展开）
│   ├── orgchart.rs      # 组织结构图（下展开）
│   └── balanced.rs      # 左右对称布局
├── connection/
│   ├── mod.rs           # 连线模块
│   ├── line.rs          # 贝塞尔曲线
│   └── router.rs        # 自动路由
├── file/
│   ├── mod.rs           # 文件模块
│   ├── format.rs        # 自有格式
│   ├── xmind.rs         # XMind 导入/导出
│   └── freemind.rs      # FreeMind 导入/导出
├── ui/
│   ├── mod.rs           # UI 组件
│   ├── toolbar.rs       # 工具栏
│   ├── sidebar.rs       # 侧边栏
│   └── properties.rs    # 属性面板
└── utils/
    ├── mod.rs
    └── id.rs            # UUID 生成
```

---

## 七、开发阶段规划

### Phase 1: 基础框架 (2-3周)
- [ ] Rust + Qt 环境搭建
- [ ] 基础窗口和画布
- [ ] 可拖拽的节点
- [ ] 简单的直线连接

### Phase 2: 核心功能 (3-4周)
- [ ] 节点增删改
- [ ] 富文本编辑
- [ ] 贝塞尔曲线连线
- [ ] 自动布局算法

### Phase 3: 文件与导入导出 (2周)
- [ ] 自有格式保存/打开
- [ ] 撤销/重做系统
- [ ] 导出图片

### Phase 4: 完善与优化 (2-3周)
- [ ] 多标签页
- [ ] 导入 XMind/FreeMind
- [ ] 快捷键系统
- [ ] 主题/样式系统
- [ ] 性能优化

---

## 八、技术选型待确认

| 问题 | 选项 A | 选项 B | 推荐 |
|-----|-------|-------|------|
| 序列化 | serde_json | - | serde_json |
| Rust Qt 绑定 | cxx-qt | rust-qt-binding | cxx-qt (更活跃) |
| 异步 | tokio | - | 暂时不需要 |
| 配置存储 | 直接 JSON | SQLite | JSON |

---

## 九、待确认事项

请确认以下内容：

1. 不是让你直接实现, 咱们是做设计, 你先出效果图. 
1. 并且, 不是让你rust +qt, 而是分别实现rust版本和qt版本, 但是, 先别高, 咱们先把效果图搞定.

---

**下一步**: 你确认需求后，我将创建技术设计文档和项目骨架。
